<title-page heading="Información de pago"></title-page>

<div class="inner-container section-gap" *ngIf="(shopping.localStorageCartProducts && shopping.localStorageCartProducts.length>0); else elseBlock">
   <div class="checkout-option">
    <div class="container">
    <div class="view-cart text-right mb-5">
      <button mat-raised-button color="accent" (click)="toggleRightSidenav()">Ver detalle de orden : {{getCartProducts() | currency:shopping?.currency}}</button>
    </div>
      <mat-accordion class="mat-ex-wrapper">
        <form card container=".card-container" [formGroup] = "paymentFormOne">
          <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)" hideToggle>
            <mat-expansion-panel-header>
              <h4 class="mb-0">Ingrese su dirección de envío</h4>
            </mat-expansion-panel-header>
            <div fxLayout="row wrap" fxLayoutAlign="none" class="col-gap" formGroupName="user_details">
              <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="100" fxFlex.lg="100" fxFlex.xl="100">
                  <div fxLayout="row wrap" fxLayoutAlign="none" class="col-gap">
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="33" fxFlex.xl="33">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="text" placeholder="Nombre" formControlName="first_name" required>
                          <mat-error *ngIf="paymentFormOne.get('user_details.first_name').hasError('required') && paymentFormOne.get('user_details.first_name').touched">Este campo no debe estar vacío.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="33" fxFlex.xl="33">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="text" placeholder="Apellido" formControlName="last_name" required>
                          <mat-error *ngIf="paymentFormOne.get('user_details.last_name').hasError('required') && paymentFormOne.get('user_details.last_name').touched">Este campo no debe estar vacío.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="33" fxFlex.xl="33">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="text" formControlName="street_name_number" placeholder="Dirección">
                          <mat-error *ngIf="paymentFormOne.get('user_details.street_name_number').hasError('required') && paymentFormOne.get('user_details.street_name_number').touched">Este campo no debe estar vacío.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                  <div fxLayout="row wrap" fxLayoutAlign="none" class="col-gap">
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="text" placeholder="Ciudad" formControlName="city_state" required>
                          <mat-error *ngIf="paymentFormOne.get('user_details.city_state').hasError('required') && paymentFormOne.get('user_details.city_state').touched">Este campo no debe estar vacío.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" style="padding-right: 30px;">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="text" placeholder="País" formControlName="country" required>
                          <mat-error *ngIf="paymentFormOne.get('user_details.country').hasError('required') && paymentFormOne.get('user_details.country').touched">Este campo no debe estar vacío.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                  <h4>Ingresa tu información de contacto</h4>
                  <div fxLayout="row wrap" fxLayoutAlign="none" class="col-gap">
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="text" placeholder="Teléfono" formControlName="mobile" required>
                          <mat-error *ngIf="paymentFormOne.get('user_details.mobile').hasError('required') && paymentFormOne.get('user_details.mobile').touched">Este campo no debe estar vacío.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" style="padding-right: 30px;">
                      <div class="mb-2">
                        <mat-form-field class="w-100">
                          <input matInput type="email" placeholder="Correo" formControlName="email" required>
                          <mat-error *ngIf="paymentFormOne.get('user_details.email').hasError('required') && paymentFormOne.get('user_details.email').touched">Este campo no debe estar vacío.</mat-error>
                          <mat-error *ngIf="paymentFormOne.get('user_details.email').hasError('pattern') && paymentFormOne.get('user_details.email').touched">Por favor, introduzca un correo electrónico válido.</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                  <div fxLayout="row wrap" fxLayoutAlign="none" class="col-gap">
                    <div fxFlex.xs="100" fxFlex.sm="50" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50">
                      <button color="accent" class="button-lg" mat-raised-button type="button" (click)="submitPayment()">Continuar con el pago </button>
                    </div>
                  </div>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)" [disabled]="isDisabledPaymentStepTwo">
            <mat-expansion-panel-header>
              <h4 class="mb-0">Opciones de Pago</h4>
            </mat-expansion-panel-header>             
                <div class="container-mat-tab card-details">
                  <div fxLayout='row wrap' class="col-gap">
                    <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" style="padding-top: 1rem;">
                      <div class="mat-inner-tab text-center">
                        <div class="header-mat-tab bg-grey">
                          <div class="mb-4"><img src="assets/images/card.png" alt="">
                          </div>
                          <h4 class="mb-5">Ingresa detalles de tarjeta</h4>
                        </div>
                      </div>
                    </div>
                    <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" formGroupName="payment">
                        <div fxLayout='row wrap' class="col-gap">
                          <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="100" fxFlex.lg="100" fxFlex.xl="100">
                            <mat-form-field class="w-100">
                              <input matInput type="text" placeholder="Número de tarjeta" formControlName="card_number" card-number>
                              <mat-error *ngIf="paymentFormOne.get('payment.card_number').hasError('required') && paymentFormOne.get('payment.card_number').touched">Este campo no debe estar vacío.</mat-error>
                            </mat-form-field>
                          </div>
                          <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="100" fxFlex.lg="100" fxFlex.xl="100">
                            <mat-form-field class="w-100">
                              <input matInput type="text" placeholder="Nombre" formControlName="user_card_name" card-name>
                              <mat-error *ngIf="paymentFormOne.get('payment.user_card_name').hasError('required') && paymentFormOne.get('payment.user_card_name').touched">Este campo no debe estar vacío.</mat-error>
                            </mat-form-field>
                          </div>
                          <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="33" fxFlex.lg="33" fxFlex.xl="33">
                            <mat-form-field class="w-100">
                              <input matInput type="text" placeholder="CVV" formControlName="cvv" card-cvc>
                              <mat-error *ngIf="paymentFormOne.get('payment.cvv').hasError('required') && paymentFormOne.get('payment.cvv').touched">Este campo no debe estar vacío.</mat-error>
                            </mat-form-field>
                          </div>
                          <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="33" fxFlex.lg="33" fxFlex.xl="33">
                            <mat-form-field class="w-100">
                              <input matInput type="text" placeholder="F. Vencimiento (01/10)" formControlName="expiry_date" card-expiry>
                              <mat-error *ngIf="paymentFormOne.get('payment.expiry_date').hasError('required') && paymentFormOne.get('payment.expiry_date').touched">Este campo no debe estar vacío.</mat-error>
                            </mat-form-field>
                          </div>
                        </div>
                        <button mat-raised-button color="accent" type="button" (click)="finalStep()">Completar</button>
                        <button mat-raised-button class="mx-2">Limpiar</button>
                    </div>                   
                  </div>
                </div>
          </mat-expansion-panel>
        </form>
      </mat-accordion>
    </div>
  </div>
</div>

<ng-template #elseBlock>
  <div class="section-gap-lg text-center">
    <div class="mb-4">
    <img src="assets/images/empty-cart.png" height="128" width="128" alt="cart-empty">
  </div>
    <h4> Tu bolsa de compra esta vacía.</h4>
    <a href="javascript:void(0)" class="primary-color" [routerLink]="['/']">Ir a comprar</a>
  </div>
</ng-template>

